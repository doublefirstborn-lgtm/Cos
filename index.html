<script>
async function startTranscription() {
  const audioUrl = document.getElementById("audioUrl").value.trim();
  const lang = document.getElementById("language").value.trim() || "auto";

  if (!audioUrl) {
    document.getElementById("result").innerText = "Please enter a link.";
    return;
  }

  document.getElementById("result").innerText = "Processing...";

  try {
    // WARNING: This exposes your OpenAI API key in the frontend
    const OPENAI_KEY = "YOUR_OPENAI_KEY_HERE";

    // Check URL type
    const lowerUrl = audioUrl.toLowerCase();
    if (
      lowerUrl.includes("youtube.com") ||
      lowerUrl.includes("youtu.be") ||
      lowerUrl.includes("tiktok.com") ||
      lowerUrl.includes("instagram.com")
    ) {
      document.getElementById("result").innerText =
        "Please provide a direct audio/video file URL (.mp3, .wav, .m4a)";
      return;
    }

    // Download audio
    const audioResp = await fetch(audioUrl);
    if (!audioResp.ok) throw new Error("Failed to fetch file");
    const audioBlob = await audioResp.blob();

    // Send to OpenAI Whisper
    const form = new FormData();
    form.append("file", audioBlob, "audiofile.mp3");
    form.append("model", "whisper-1");
    if (lang !== "auto") form.append("language", lang);

    const whisperResp = await fetch("https://api.openai.com/v1/audio/transcriptions", {
      method: "POST",
      headers: {
        Authorization: `Bearer ${OPENAI_KEY}`
      },
      body: form
    });

    const data = await whisperResp.json();
    if (data.error) {
      document.getElementById("result").innerText = "Error: " + data.error.message;
    } else {
      document.getElementById("result").innerText = data.text;
    }
  } catch (err) {
    document.getElementById("result").innerText = "Failed: " + err.message;
  }
}
</script>
